@if(isMobile){
<app-customers-mobile
  [customers]="customers"
  (create)="showCreateModal()"
  (showDetails)="showCustomerDetails($event)"
  (edit)="editCustomer($event)"
  (delete)="deleteCustomer($event)"
  (closeActionMenu)="closeActionMenu()"
  (filterActiveChange)="filterActive = $event; loadCustomers()" (toggleActionMenu)="toggleActionMenu($event)"
  (searchTermChange)="searchTerm = $event; onSearchChange()"
/>
} @else {
<div class="page-container" (click)="closeActionMenu()">
  <div class="page-header">
    <h1>{{ 'CUSTOMERS.TITLE' | translate }}</h1>
    <button class="btn-primary" (click)="showCreateModal()">+ {{ 'CUSTOMERS.NEW' | translate }}</button>
  </div>

  <div class="filters">
    <input type="search" [placeholder]="'CUSTOMERS.SEARCH' | translate" [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange()" class="search-input" />
    <select [(ngModel)]="filterActive" (ngModelChange)="loadCustomers()" class="filter-select">
      <option [ngValue]="undefined">{{ 'COMMON.ALL' | translate }}</option>
      <option [ngValue]="true">{{ 'DASHBOARD.ACTIVE' | translate }}</option>
      <option [ngValue]="false">{{ 'ADMIN.STATUS.BLOCKED' | translate }}</option>
    </select>
  </div>

  <app-table-container>
    <table class="data-table">
      <thead>
        <tr>
          <!-- <th>Kundennr.</th> -->
          <th>{{ 'COMMON.NAME' | translate }}</th>
          <th>{{ 'COMMON.EMAIL' | translate }}</th>
          <th>{{ 'COMMON.PHONE' | translate }}</th>
          <th>{{ 'COMMON.STATUS' | translate }}</th>
          <th>{{ 'COMMON.ACTIONS' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        @for(customer of customers; track customer){
        <tr>
          <!-- <td data-label="Kundennr.">{{ customer.customerNumber }}</td> -->
          <td [attr.data-label]="'COMMON.NAME' | translate">{{ customer.firstName }} {{ customer.lastName }}</td>
          <td [attr.data-label]="'COMMON.EMAIL' | translate">{{ customer.email || '-' }}</td>
          <td [attr.data-label]="'COMMON.PHONE' | translate">
            @if(customer.phone){
            <span class="phone-container">
              {{ customer.phone }}
              <a [href]="'tel:' + customer.phone" class="phone-icon" [title]="'COMMON.PHONE' | translate">ðŸ“ž</a>
            </span>
          }@else{
            <span>-</span>
          }
          </td>
          <td [attr.data-label]="'COMMON.STATUS' | translate">
            <span class="badge" [class.badge-active]="customer.isActive" [class.badge-inactive]="!customer.isActive">
              {{ customer.isActive ? ('DASHBOARD.ACTIVE' | translate) : ('ADMIN.STATUS.BLOCKED' | translate) }}
            </span>
          </td>
          <td class="actions-cell" [attr.data-label]="'COMMON.ACTIONS' | translate">
            <div class="action-menu-container">
              <button class="action-menu-btn" (click)="toggleActionMenu(customer._id); $event.stopPropagation()">
                <i class="fas fa-ellipsis-v"></i>
              </button>
              @if(activeMenuId === customer._id){
                <div class="action-menu" (click)="$event.stopPropagation()">
                  <button class="menu-item" (click)="showCustomerDetails(customer); closeActionMenu()">
                    <i class="fas fa-info-circle fa-lg"></i> {{ 'COMMON.DETAILS' | translate }}
                  </button>
                  <button class="menu-item" (click)="editCustomer(customer); closeActionMenu()">
                    <i class="fas fa-edit fa-lg"></i> {{ 'COMMON.EDIT' | translate }}
                  </button>
                  <button class="menu-item menu-item-danger"
                    (click)="deleteCustomer(customer._id); closeActionMenu()">
                    <i class="fas fa-trash fa-lg"></i> {{ 'COMMON.DELETE' | translate }}
                  </button>
                </div>
              }
            </div>
          </td>
        </tr>
      }
      </tbody>
    </table>
  </app-table-container>

  <!-- Pagination -->
  @if(totalPages > 1){
    <div class="pagination">
      <div class="pagination-info">
        {{ 'COMMON.SHOWING' | translate }} {{ (currentPage - 1) * pageSize + 1 }} - {{ currentPage * pageSize > totalItems ? totalItems : currentPage * pageSize }} {{ 'COMMON.OF' | translate }} {{ totalItems }}
      </div>
      <div class="pagination-controls">
        <button class="pagination-btn" (click)="goToPage(1)" [disabled]="currentPage === 1" title="Erste Seite">
          <i class="fas fa-angle-double-left"></i>
        </button>
        <button class="pagination-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1" title="Vorherige Seite">
          <i class="fas fa-angle-left"></i>
        </button>
        @for(page of getVisiblePages(); track page){
          <button class="pagination-btn" [class.active]="page === currentPage" (click)="goToPage(page)">
            {{ page }}
          </button>
        }
        <button class="pagination-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages" title="NÃ¤chste Seite">
          <i class="fas fa-angle-right"></i>
        </button>
        <button class="pagination-btn" (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages" title="Letzte Seite">
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
      <div class="pagination-size">
        <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()" class="page-size-select">
          <option [ngValue]="10">10</option>
          <option [ngValue]="25">25</option>
          <option [ngValue]="50">50</option>
          <option [ngValue]="100">100</option>
        </select>
        <span>{{ 'COMMON.PER_PAGE' | translate }}</span>
      </div>
    </div>
  }
</div>
}

<!-- Modal for Create/Edit Customer -->
 @if(showModal){
<app-overlay-modal (close)="closeModal()">
  <h2>{{ editMode ? ('CUSTOMERS.EDIT' | translate) : ('CUSTOMERS.NEW' | translate) }}</h2>
  <form (ngSubmit)="saveCustomer()">
    <div class="form-group">
      <label>{{ 'CUSTOMERS.FIELDS.SALUTATION' | translate }}</label>
      <select [(ngModel)]="currentCustomer.anrede" name="anrede">
        <option [ngValue]="undefined">{{ 'COMMON.SELECT' | translate }}</option>
        <option value="Herr">{{ 'CUSTOMERS.FIELDS.MR' | translate }}</option>
        <option value="Frau">{{ 'CUSTOMERS.FIELDS.MRS' | translate }}</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>{{ 'CUSTOMERS.FIELDS.FIRST_NAME' | translate }}*</label>
        <input type="text" [(ngModel)]="currentCustomer.firstName" name="firstName" required />
      </div>
      <div class="form-group">
        <label>{{ 'CUSTOMERS.FIELDS.LAST_NAME' | translate }}*</label>
        <input type="text" [(ngModel)]="currentCustomer.lastName" name="lastName" required />
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>{{ 'COMMON.EMAIL' | translate }}</label>
        <input type="email" [(ngModel)]="currentCustomer.email" name="email" />
      </div>
      <div class="form-group">
        <label>{{ 'COMMON.PHONE' | translate }}</label>
        <input type="tel" [(ngModel)]="currentCustomer.phone" name="phone" />
      </div>
</div>
    @if(currentCustomer.address){
      <label>{{ 'CUSTOMERS.FIELDS.ADDRESS' | translate }}:</label>
      <hr/>
      <div class="form-group">
          <label>{{ 'CUSTOMERS.FIELDS.STREET' | translate }}</label>
          <input type="text"
              name="street"
              [(ngModel)]="currentCustomer.address.street"
              [placeholder]="'CUSTOMERS.FIELDS.STREET' | translate"
              class="form-control" />
          <div class="form-row">
              <div class="form-group">
                <label>{{ 'CUSTOMERS.FIELDS.ZIP' | translate }}</label>
                <input type="text"
                    name="zip"
                    [(ngModel)]="currentCustomer.address.zip"
                    [placeholder]="'CUSTOMERS.FIELDS.ZIP' | translate"
                    class="form-control"
                />
              </div>
              <div class="form-group">
                <label>{{ 'CUSTOMERS.FIELDS.CITY' | translate }}</label>
                  <input type="text"
                      name="city"
                      [(ngModel)]="currentCustomer.address.city"
                      [placeholder]="'CUSTOMERS.FIELDS.CITY' | translate"
                      class="form-control"
                  />
              </div>
          </div>
        </div>
    }
    <div class="form-group">
      <label>{{ 'COMMON.NOTES' | translate }}</label>
      <textarea [(ngModel)]="currentCustomer.notes" name="notes" rows="3"></textarea>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-secondary" (click)="closeModal()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button type="submit" class="btn-primary">{{ 'COMMON.SAVE' | translate }}</button>
    </div>
  </form>
</app-overlay-modal>
}

<!-- Modal for Customer Details -->
@if(showCustomerDetailsModal){
  <app-overlay-modal (close)="closeCustomerDetailsModal()">
    <div class="modal-header">
      <h2>{{ selectedCustomer?.fullName }}</h2>
      <button class="btn-close" (click)="closeCustomerDetailsModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <app-customer-detail
      [customer]="selectedCustomer"
      [contracts]="customerContracts"
      [showContracts]="true"
      (contractClick)="onContractClick($event)"
    />
    <div class="modal-footer">
      <button type="button" class="btn-secondary" (click)="closeCustomerDetailsModal()">{{ 'COMMON.CLOSE' | translate }}</button>
    </div>
  </app-overlay-modal>
}