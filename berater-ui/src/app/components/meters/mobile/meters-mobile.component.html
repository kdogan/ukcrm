<div class="mobile-page">
  <!-- HEADER -->
  <div class="mobile-header">
    <h1>{{ 'METERS.TITLE' | translate }}</h1>
    <button class="fab" (click)="create.emit()">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <!-- FILTER BAR -->
  <div class="mobile-filters">
    <input
      type="search"
      [placeholder]="'METERS.SEARCH' | translate"
      [ngModel]="searchTerm"
      (ngModelChange)="searchTermChange.emit($event)"
    />
    <div class="filter-row">
      <select [ngModel]="statusFilterTerm" (ngModelChange)="filterStatusChange.emit($event)">
        <option value="">{{ 'COMMON.ALL' | translate }}</option>
        <option value="free">{{ 'METERS.STATUS.FREE' | translate }}</option>
        <option value="occupied">{{ 'METERS.STATUS.OCCUPIED' | translate }}</option>
      </select>
      <select [ngModel]="typeFilterTerm" (ngModelChange)="filterTypeChange.emit($event)">
        <option value="">{{ 'COMMON.ALL' | translate }}</option>
        @for(type of getMeterTypeWithLabel(); track type){
          <option [value]=type.key>{{type.value}}</option>
        }
      </select>
    </div>
  </div>

  <!-- LIST -->
  <div class="card-list">
    <div class="eskapp-card clickable-card" *ngFor="let meter of meters" (click)="showDetails.emit(meter)">
        <div class="meter-card-header">
            <h2>ZÃ¤hlernummer: {{ meter?.meterNumber }}</h2>
            <div class="status-icon"
                [class.active]="!meter.isFree"
                [class.inactive]="meter.isFree">
                <i class="fas" [ngClass]="meter.isFree ? 'fa-unlink' : 'fa-link'"></i>
            </div>
        </div>

        <div class="meter-card-content">
            <div class="content-row">Type: {{getTypeLabel(meter.type)}}</div>
            <div class="content-row">
              @if(meter.isTwoTariff){
                letzte Ablesung HT: {{ meter.currentReadingHT || '-' }} {{ meter.currentReadingHT ? getMeterUnit(meter.type) : '' }}<br>
                letzte Ablesung NT: {{ meter.currentReadingNT || '-' }} {{ meter.currentReadingNT ? getMeterUnit(meter.type) : '' }}
              }@else{
                letzte Ablesung: {{ meter.currentReading || '-' }} {{ meter.currentReading ? getMeterUnit(meter.type) : '' }}
              }
            </div>
            @if(!meter.isFree && meter.currentCustomerId){
              <div class="content-row">
                {{ 'METERS.FIELDS.OWNER' | translate }}:
                <span class="customer-link" (click)="showCustomerDetails.emit(meter.currentCustomerId); $event.stopPropagation()">
                  {{ meter.currentCustomerId.firstName }} {{ meter.currentCustomerId.lastName }}
                </span>
              </div>
            }
        </div>

      <div class="actions" (click)="$event.stopPropagation()">
        <button class="edit" (click)="edit.emit(meter)" [title]="'COMMON.EDIT' | translate">
          <i class="fas fa-edit"></i>
        </button>
        <button class="complete" (click)="addReading.emit(meter)" [title]="'METERS.ADD_READING' | translate">
          <i class="fas fa-plus-circle"></i>
        </button>
        <button class="view" (click)="viewReadings.emit(meter)" [title]="'METERS.VIEW_READINGS' | translate">
          <i class="fas fa-eye"></i>
        </button>
        <button class="chart" (click)="showYearlyEstimates.emit(meter)" title="Jahresverbrauch">
          <i class="fas fa-chart-line"></i>
        </button>
        @if(meter.isFree){
          <button class="contract" (click)="createContract.emit(meter)" [title]="'CONTRACTS.NEW' | translate">
            <i class="fas fa-file-contract"></i>
          </button>
        }
      </div>

    </div>
  </div>

</div>
