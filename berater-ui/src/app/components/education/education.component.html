@if (viewportService.isMobile()) {
  <app-education-mobile
    [materials]="filteredMaterials"
    [stats]="stats"
    [isMasterBerater]="isMasterBerater"
    [loading]="loading"
    [searchTerm]="searchTerm"
    [selectedCategory]="selectedCategory"
    [selectedType]="selectedType"
    [selectedLanguage]="selectedLanguage"
    [categoryOptions]="categoryOptions"
    [typeOptions]="typeOptions"
    [languageOptions]="languageOptions"
    [shareToken]="shareToken"
    [connectedMasterBerater]="connectedMasterBerater"
    [tokenInput]="tokenInput"
    [tokenError]="tokenError"
    [tokenSuccess]="tokenSuccess"
    (createMaterial)="openCreateModal()"
    (editMaterial)="openEditModal($event)"
    (deleteMaterial)="confirmDelete($event)"
    (viewMaterial)="viewMaterial($event)"
    (searchChange)="onSearchChange($event)"
    (categoryChange)="onCategoryChange($event)"
    (typeChange)="onTypeChange($event)"
    (languageChange)="onLanguageChange($event)"
    (filterChange)="filterMaterials()"
    (resetFilters)="resetFilters()"
    (generateToken)="generateToken()"
    (connectWithToken)="connectWithToken()"
    (disconnectFromMaster)="confirmDisconnect()"
    (copyToken)="copyTokenToClipboard()"
    (tokenInputChange)="tokenInput = $event"
  />
} @else {
  <app-education-desktop
    [materials]="filteredMaterials"
    [stats]="stats"
    [isMasterBerater]="isMasterBerater"
    [loading]="loading"
    [searchTerm]="searchTerm"
    [selectedCategory]="selectedCategory"
    [selectedType]="selectedType"
    [selectedLanguage]="selectedLanguage"
    [categoryOptions]="categoryOptions"
    [typeOptions]="typeOptions"
    [languageOptions]="languageOptions"
    [shareToken]="shareToken"
    [connectedMasterBerater]="connectedMasterBerater"
    [tokenInput]="tokenInput"
    [tokenError]="tokenError"
    [tokenSuccess]="tokenSuccess"
    (createMaterial)="openCreateModal()"
    (editMaterial)="openEditModal($event)"
    (deleteMaterial)="confirmDelete($event)"
    (viewMaterial)="viewMaterial($event)"
    (searchChange)="onSearchChange($event)"
    (categoryChange)="onCategoryChange($event)"
    (typeChange)="onTypeChange($event)"
    (languageChange)="onLanguageChange($event)"
    (filterChange)="filterMaterials()"
    (resetFilters)="resetFilters()"
    (generateToken)="generateToken()"
    (connectWithToken)="connectWithToken()"
    (disconnectFromMaster)="confirmDisconnect()"
    (copyToken)="copyTokenToClipboard()"
    (tokenInputChange)="tokenInput = $event"
  />
}

<!-- Create/Edit Modal -->
@if (showModal) {
<app-overlay-modal (close)="closeModal()">
  <div class="modal-content">
    <h2 class="modal-title">{{ isEditMode ? ('EDUCATION.EDIT_MATERIAL' | translate) : ('EDUCATION.NEW_MATERIAL' | translate) }}</h2>
    <form (ngSubmit)="saveMaterial()">
      <div class="form-group">
        <label for="title">{{ 'EDUCATION.FIELDS.TITLE' | translate }} *</label>
        <input
          type="text"
          id="title"
          class="form-control"
          [(ngModel)]="currentMaterial.title"
          name="title"
          required
        />
      </div>

      <div class="form-group">
        <label for="type">{{ 'EDUCATION.FIELDS.TYPE' | translate }} *</label>
        <select
          id="type"
          class="form-control"
          [(ngModel)]="currentMaterial.type"
          name="type"
          required
        >
          <option value="video">{{ 'EDUCATION.TYPES.VIDEO' | translate }}</option>
          <option value="pdf">{{ 'EDUCATION.TYPES.PDF' | translate }}</option>
          <option value="document">{{ 'EDUCATION.TYPES.DOCUMENT' | translate }}</option>
          <option value="link">{{ 'EDUCATION.TYPES.LINK' | translate }}</option>
          <option value="image">{{ 'EDUCATION.TYPES.IMAGE' | translate }}</option>
        </select>
      </div>

      <!-- PDF Upload -->
      @if (currentMaterial.type === 'pdf') {
        <div class="form-group">
          <label for="pdfFile">{{ 'COMMON.UPLOAD' | translate }} PDF *</label>
          <input
            type="file"
            id="pdfFile"
            class="form-control"
            (change)="onPdfSelected($event)"
            accept="application/pdf"
            [required]="!isEditMode || !currentMaterial.pdfName"
          />
          <small class="form-text">{{ 'EDUCATION.MAX_FILE_SIZE' | translate }}: 12 MB</small>
          @if (currentMaterial.pdfName) {
            <small class="form-text text-success">{{ 'EDUCATION.CURRENT_FILE' | translate }}: {{ currentMaterial.pdfName }}</small>
          }
        </div>
      }


      <div class="form-group">
        <label for="category">{{ 'EDUCATION.FIELDS.CATEGORY' | translate }} *</label>
        <select
          id="category"
          class="form-control"
          [(ngModel)]="currentMaterial.category"
          name="category"
          required
        >
          <option value="onboarding">{{ 'EDUCATION.CATEGORIES.ONBOARDING' | translate }}</option>
          <option value="training">{{ 'EDUCATION.CATEGORIES.TRAINING' | translate }}</option>
          <option value="product-info">{{ 'EDUCATION.CATEGORIES.PRODUCT' | translate }}</option>
          <option value="sales">{{ 'EDUCATION.CATEGORIES.SALES' | translate }}</option>
          <option value="support">{{ 'SUPPORT.TITLE' | translate }}</option>
          <option value="other">{{ 'EDUCATION.CATEGORIES.OTHER' | translate }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="language">{{ 'EDUCATION.FIELDS.LANGUAGE' | translate }} *</label>
        <select
          id="language"
          class="form-control"
          [(ngModel)]="currentMaterial.language"
          name="language"
          required
        >
          <option value="de">{{ 'EDUCATION.LANGUAGES.GERMAN' | translate }}</option>
          <option value="tr">{{ 'EDUCATION.LANGUAGES.TURKISH' | translate }}</option>
        </select>
      </div>

      @if (currentMaterial.type !== 'pdf') {
        <div class="form-group">
          <label for="url">{{ 'EDUCATION.FIELDS.URL' | translate }} *</label>
          <input
            type="url"
            id="url"
            class="form-control"
            [(ngModel)]="currentMaterial.url"
            name="url"
            placeholder="https://..."
            required
          />
          @if (currentMaterial.type === 'video') {
            <small class="form-text">{{ 'EDUCATION.YOUTUBE_URL_HINT' | translate }}</small>
          }
        </div>
      }

      <div class="form-group">
        <label for="description">{{ 'EDUCATION.FIELDS.DESCRIPTION' | translate }}</label>
        <textarea
          id="description"
          class="form-control"
          [(ngModel)]="currentMaterial.description"
          name="description"
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label>{{ 'EDUCATION.SHARE_WITH_BERATER' | translate }}</label>
        <div class="berater-list">
          @for (berater of beraterList; track berater._id) {
            <div class="checkbox-wrapper-compact" style="margin-bottom: 0.5rem;">
              <input
                type="checkbox"
                [id]="'berater-' + berater._id"
                [checked]="isBeraterSelected(berater._id)"
                (change)="toggleBeraterSelection(berater, $event)"
                class="checkbox-input"
              />
              <label [for]="'berater-' + berater._id" class="checkbox-label">
                {{ berater.firstName }} {{ berater.lastName }}
                @if (berater.isMasterBerater) {
                  <span class="badge-master">Master</span>
                }
              </label>
            </div>
          }
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          {{ 'COMMON.CANCEL' | translate }}
        </button>
        <button type="submit" class="btn btn-primary">
          {{ isEditMode ? ('COMMON.UPDATE' | translate) : ('COMMON.CREATE' | translate) }}
        </button>
      </div>
    </form>
  </div>
</app-overlay-modal>
}

<!-- Delete Confirmation Modal -->
@if (showDeleteConfirm) {
<app-overlay-modal (close)="cancelDelete()">
  <div class="modal-content">
    <h2 class="modal-title">{{ 'EDUCATION.DELETE_MATERIAL' | translate }}</h2>
    <p>{{ 'EDUCATION.MESSAGES.DELETE_CONFIRM' | translate }} "{{ materialToDelete?.title }}"?</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelDelete()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button class="btn btn-danger" (click)="deleteMaterial()">{{ 'COMMON.DELETE' | translate }}</button>
    </div>
  </div>
</app-overlay-modal>
}

<!-- Disconnect Confirmation Modal -->
@if (showDisconnectConfirm) {
<app-overlay-modal (close)="cancelDisconnect()">
  <div class="modal-content">
    <h2 class="modal-title">{{ 'EDUCATION.TOKEN.DISCONNECT_CONFIRM_TITLE' | translate }}</h2>
    <p>{{ 'EDUCATION.TOKEN.DISCONNECT_CONFIRM_MESSAGE' | translate }}</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelDisconnect()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button class="btn btn-danger" (click)="disconnectFromMaster()">{{ 'EDUCATION.TOKEN.DISCONNECT' | translate }}</button>
    </div>
  </div>
</app-overlay-modal>
}

<!-- YouTube Video Player - Direct Fullscreen Overlay -->
@if (showVideoPlayer) {
<div class="video-fullscreen-overlay" (click)="closeVideoPlayer()">
  <div class="video-fullscreen-container" (click)="$event.stopPropagation()">
    <button class="video-close-btn" (click)="closeVideoPlayer()" title="Schließen">
      ✕
    </button>
    <iframe
      [src]="getYouTubeEmbedUrl()"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
      allowfullscreen
      webkitallowfullscreen
      mozallowfullscreen
    ></iframe>
  </div>
</div>
}

@if (showPdfViewer && currentPdfDataUrl) {
  <app-overlay-modal (close)="closePdfViewer()">
    <div class="pdf-fullscreen-overlay" (click)="closePdfViewer()">
      <div class="pdf-fullscreen-container" (click)="$event.stopPropagation()">
        <button class="pdf-close-btn" (click)="closePdfViewer()" title="Schließen">✕</button>
        <iframe [src]="currentPdfDataUrl" frameborder="0" width="100%" height="100%" type="application/pdf"></iframe>
      </div>
    </div>
  </app-overlay-modal>
}

