@if(viewportService.isMobile()){
<app-todos-mobile
  [filteredTodos]="filteredTodos"
  [mainView]="mainView"
  [calendarView]="calendarView"
  [calendarDate]="calendarDate"
  [selectedDay]="selectedDay"
  [monthDays]="monthDays"
  (create)="showCreateModal()"
  (edit)="editTodo($event)"
  (delete)="deleteTodo($event)"
  (complete)="completeTodo($event)"
  (generateAuto)="generateAutoTodos()"
  (mainViewChange)="mainView = $event"
  (filterChange)="onFilterChange($event)"
  (navigateToCustomer)="navigateToCustomer($event)"
  (navigateToContract)="navigateToContract($event)"
  (navigateToMeter)="navigateToMeter($event)"
  (changeMonthEvent)="changeMonth($event)"
  (openDayEvent)="openDay($event)"
  (backToMonthEvent)="backToMonth()" />
}@else{
<app-todos-desktop
  [filteredTodos]="filteredTodos"
  [mainView]="mainView"
  [calendarView]="calendarView"
  [calendarDate]="calendarDate"
  [selectedDay]="selectedDay"
  [monthDays]="monthDays"
  (create)="showCreateModal()"
  (edit)="editTodo($event)"
  (delete)="deleteTodo($event)"
  (complete)="completeTodo($event)"
  (generateAuto)="generateAutoTodos()"
  (mainViewChange)="mainView = $event"
  (filterChange)="onFilterChange($event)"
  (navigateToCustomer)="navigateToCustomer($event)"
  (navigateToContract)="navigateToContract($event)"
  (navigateToMeter)="navigateToMeter($event)"
  (changeMonthEvent)="changeMonth($event)"
  (openDayEvent)="openDay($event)"
  (backToMonthEvent)="backToMonth()" />
}

<!-- Modal for Create/Edit TODO -->
<app-overlay-modal *ngIf="showModal" (close)="closeModal()">
  <div class="modal-header">
    <h2>{{ isEditMode ? ('TODOS.EDIT' | translate) : ('TODOS.NEW' | translate) }}</h2>
    <button class="btn-close" (click)="closeModal()">&times;</button>
  </div>

  <form (ngSubmit)="saveTodo()" #todoForm="ngForm">
    <div class="form-group">
      <label for="title">{{ 'TODOS.FIELDS.TITLE' | translate }} *</label>
      <input type="text" id="title" name="title" [(ngModel)]="currentTodo.title" required
        class="form-control" />
    </div>

    <div class="form-group">
      <label for="description">{{ 'TODOS.FIELDS.DESCRIPTION' | translate }}</label>
      <textarea id="description" name="description" [(ngModel)]="currentTodo.description" rows="4"
        class="form-control"></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="priority">{{ 'TODOS.FIELDS.PRIORITY' | translate }}</label>
        <select id="priority" name="priority" [(ngModel)]="currentTodo.priority" class="form-control">
          <option value="low">{{ 'TODOS.PRIORITY.LOW' | translate }}</option>
          <option value="medium">{{ 'TODOS.PRIORITY.MEDIUM' | translate }}</option>
          <option value="high">{{ 'TODOS.PRIORITY.HIGH' | translate }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="status">{{ 'TODOS.FIELDS.STATUS' | translate }}</label>
        <select id="status" name="status" [(ngModel)]="currentTodo.status" class="form-control">
          <option value="open">{{ 'TODOS.STATUS.OPEN' | translate }}</option>
          <option value="in_progress">{{ 'TODOS.STATUS.IN_PROGRESS' | translate }}</option>
          <option value="completed">{{ 'TODOS.STATUS.COMPLETED' | translate }}</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="dueDate">{{ 'TODOS.FIELDS.DUE_DATE' | translate }}</label>
      <input type="date" id="dueDate" name="dueDate" [(ngModel)]="currentTodo.dueDate"
        class="form-control" />
    </div>

    <div class="form-section">
      <h3>{{ 'TODOS.LINKS' | translate }}</h3>

      <div class="form-group">
        <label for="relatedCustomerId">{{ 'TODOS.FIELDS.CUSTOMER' | translate }}</label>
        <select id="relatedCustomerId" name="relatedCustomerId"
          [(ngModel)]="currentTodo.relatedCustomerId" class="form-control">
          <option [ngValue]="null">{{ 'TODOS.NO_CUSTOMER' | translate }}</option>
          <option *ngFor="let customer of customers" [value]="customer._id">
            {{ customer.firstName }} {{ customer.lastName }} ({{ customer.customerNumber }})
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="relatedContractId">{{ 'TODOS.FIELDS.CONTRACT' | translate }}</label>
        <select id="relatedContractId" name="relatedContractId"
          [(ngModel)]="currentTodo.relatedContractId" class="form-control">
          <option [ngValue]="null">{{ 'TODOS.NO_CONTRACT' | translate }}</option>
          <option *ngFor="let contract of contracts" [value]="contract._id">
            {{ contract.contractNumber }} - {{ contract.customerId?.firstName }} {{
            contract.customerId?.lastName }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="relatedMeterId">{{ 'TODOS.FIELDS.METER' | translate }}</label>
        <select id="relatedMeterId" name="relatedMeterId" [(ngModel)]="currentTodo.relatedMeterId"
          class="form-control">
          <option [ngValue]="null">{{ 'TODOS.NO_METER' | translate }}</option>
          <option *ngFor="let meter of meters" [value]="meter._id">
            {{ meter.meterNumber }} ({{ getTypeLabel(meter.type) }})
          </option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-secondary" (click)="closeModal()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button type="submit" class="btn-primary" [disabled]="!todoForm.form.valid">
        {{ isEditMode ? ('COMMON.SAVE' | translate) : ('COMMON.CREATE' | translate) }}
      </button>
    </div>
  </form>
</app-overlay-modal>
