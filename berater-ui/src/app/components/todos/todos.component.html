    <div class="page-container">
      <div class="page-header">
        <h1>TODOs</h1>
        <div class="header-actions">
          <button class="btn-secondary" (click)="generateAutoTodos()">Automatische TODOs generieren</button>
          <button class="btn-primary" (click)="showCreateModal()">+ Neues TODO</button>
        </div>
      </div>

      <div class="filters">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="filterTodos()"
          placeholder="Suchen..."
          class="search-input"
        />
        <select [(ngModel)]="statusFilter" (ngModelChange)="filterTodos()" class="filter-select">
          <option value="">Alle Status</option>
          <option value="open">Offen</option>
          <option value="in_progress">In Bearbeitung</option>
          <option value="completed">Erledigt</option>
        </select>
        <select [(ngModel)]="priorityFilter" (ngModelChange)="filterTodos()" class="filter-select">
          <option value="">Alle PrioritÃ¤ten</option>
          <option value="high">Hoch</option>
          <option value="medium">Mittel</option>
          <option value="low">Niedrig</option>
        </select>
      </div>

      <div class="todos-grid">
        <div *ngFor="let todo of filteredTodos"
             class="todo-card"
             [class.priority-high]="todo.priority === 'high'"
             [class.priority-medium]="todo.priority === 'medium'"
             [class.priority-low]="todo.priority === 'low'"
             [class.completed]="todo.status === 'completed'">

          <div class="todo-header">
            <div class="todo-badges">
              <span class="badge badge-priority" [class]="'priority-' + todo.priority">
                {{ getPriorityLabel(todo.priority) }}
              </span>
              <span class="badge badge-status" [class]="'status-' + todo.status">
                {{ getStatusLabel(todo.status) }}
              </span>
              <span *ngIf="todo.isAutoGenerated" class="badge badge-auto">Automatisch</span>
            </div>
            <button class="btn-icon" (click)="deleteTodo(todo._id)">&times;</button>
          </div>

          <h3 class="todo-title">{{ todo.title }}</h3>
          <p *ngIf="todo.description" class="todo-description">{{ todo.description }}</p>

          <div class="todo-meta">
            <div *ngIf="todo.dueDate" class="due-date" [class.overdue]="isOverdue(todo.dueDate)">
              <span class="icon">ðŸ“…</span>
              <span>{{ todo.dueDate | date:'dd.MM.yyyy' }}</span>
              <span *ngIf="isOverdue(todo.dueDate)" class="overdue-label">ÃœberfÃ¤llig</span>
            </div>
          </div>

          <div class="todo-relations" *ngIf="hasRelations(todo)">
            <div *ngIf="todo.relatedCustomerId && todo.relatedCustomerId.firstName" class="relation-item">
              <span class="relation-icon">ðŸ‘¤</span>
              <a (click)="navigateToCustomer(todo.relatedCustomerId._id)" class="relation-link">
                {{ todo.relatedCustomerId.firstName }} {{ todo.relatedCustomerId.lastName }}
              </a>
            </div>
            <div *ngIf="todo.relatedContractId && todo.relatedContractId.contractNumber" class="relation-item">
              <span class="relation-icon">ðŸ“„</span>
              <a (click)="navigateToContract(todo.relatedContractId._id)" class="relation-link">
                Vertrag {{ todo.relatedContractId.contractNumber }}
              </a>
            </div>
            <div *ngIf="todo.relatedMeterId && todo.relatedMeterId.meterNumber" class="relation-item">
              <span class="relation-icon">âš¡</span>
              <a (click)="navigateToMeter(todo.relatedMeterId._id)" class="relation-link">
                ZÃ¤hler {{ todo.relatedMeterId.meterNumber }}
              </a>
            </div>
          </div>

          <div class="todo-actions">
            <button *ngIf="todo.status !== 'completed'"
                    class="btn-small btn-success"
                    (click)="completeTodo(todo._id)">
              âœ“ Erledigen
            </button>
            <button class="btn-small" (click)="editTodo(todo)">Bearbeiten</button>
          </div>
        </div>

        <div *ngIf="filteredTodos.length === 0" class="no-data">
          <p>Keine TODOs gefunden</p>
        </div>
      </div>

      <!-- Modal for Create/Edit TODO -->
      <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditMode ? 'TODO bearbeiten' : 'Neues TODO' }}</h2>
            <button class="btn-close" (click)="closeModal()">&times;</button>
          </div>

          <form (ngSubmit)="saveTodo()" #todoForm="ngForm">
            <div class="form-group">
              <label for="title">Titel *</label>
              <input
                type="text"
                id="title"
                name="title"
                [(ngModel)]="currentTodo.title"
                required
                class="form-control"
                placeholder="z.B. Adresse von Kunde Ã¤ndern"
              />
            </div>

            <div class="form-group">
              <label for="description">Beschreibung</label>
              <textarea
                id="description"
                name="description"
                [(ngModel)]="currentTodo.description"
                rows="4"
                class="form-control"
                placeholder="ZusÃ¤tzliche Details..."
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="priority">PrioritÃ¤t</label>
                <select id="priority" name="priority" [(ngModel)]="currentTodo.priority" class="form-control">
                  <option value="low">Niedrig</option>
                  <option value="medium">Mittel</option>
                  <option value="high">Hoch</option>
                </select>
              </div>

              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status" [(ngModel)]="currentTodo.status" class="form-control">
                  <option value="open">Offen</option>
                  <option value="in_progress">In Bearbeitung</option>
                  <option value="completed">Erledigt</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="dueDate">FÃ¤lligkeitsdatum</label>
              <input
                type="date"
                id="dueDate"
                name="dueDate"
                [(ngModel)]="currentTodo.dueDate"
                class="form-control"
              />
            </div>

            <div class="form-section">
              <h3>VerknÃ¼pfungen (optional)</h3>

              <div class="form-group">
                <label for="relatedCustomerId">Kunde</label>
                <select id="relatedCustomerId" name="relatedCustomerId"
                        [(ngModel)]="currentTodo.relatedCustomerId"
                        class="form-control">
                  <option [ngValue]="null">Kein Kunde</option>
                  <option *ngFor="let customer of customers" [value]="customer._id">
                    {{ customer.firstName }} {{ customer.lastName }} ({{ customer.customerNumber }})
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label for="relatedContractId">Vertrag</label>
                <select id="relatedContractId" name="relatedContractId"
                        [(ngModel)]="currentTodo.relatedContractId"
                        class="form-control">
                  <option [ngValue]="null">Kein Vertrag</option>
                  <option *ngFor="let contract of contracts" [value]="contract._id">
                    {{ contract.contractNumber }} - {{ contract.customerId?.firstName }} {{ contract.customerId?.lastName }}
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label for="relatedMeterId">ZÃ¤hler</label>
                <select id="relatedMeterId" name="relatedMeterId"
                        [(ngModel)]="currentTodo.relatedMeterId"
                        class="form-control">
                  <option [ngValue]="null">Kein ZÃ¤hler</option>
                  <option *ngFor="let meter of meters" [value]="meter._id">
                    {{ meter.meterNumber }} ({{ getTypeLabel(meter.type) }})
                  </option>
                </select>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn-secondary" (click)="closeModal()">Abbrechen</button>
              <button type="submit" class="btn-primary" [disabled]="!todoForm.form.valid">
                {{ isEditMode ? 'Speichern' : 'Erstellen' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>