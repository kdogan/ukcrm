@if(viewportService.isMobile()){
<app-todos-mobile
  [filteredTodos]="filteredTodos"
  [mainView]="mainView"
  [calendarView]="calendarView"
  [calendarDate]="calendarDate"
  [selectedDay]="selectedDay"
  [monthDays]="monthDays"
  (create)="showCreateModal()"
  (edit)="editTodo($event)"
  (delete)="deleteTodo($event)"
  (complete)="completeTodo($event)"
  (generateAuto)="generateAutoTodos()"
  (mainViewChange)="mainView = $event"
  (filterChange)="onFilterChange($event)"
  (navigateToCustomer)="navigateToCustomer($event)"
  (navigateToContract)="navigateToContract($event)"
  (navigateToMeter)="navigateToMeter($event)"
  (changeMonthEvent)="changeMonth($event)"
  (openDayEvent)="openDay($event)"
  (backToMonthEvent)="backToMonth()" />
}@else{
<app-todos-desktop
  [filteredTodos]="filteredTodos"
  [mainView]="mainView"
  [calendarView]="calendarView"
  [calendarDate]="calendarDate"
  [selectedDay]="selectedDay"
  [monthDays]="monthDays"
  (create)="showCreateModal()"
  (edit)="editTodo($event)"
  (delete)="deleteTodo($event)"
  (complete)="completeTodo($event)"
  (generateAuto)="generateAutoTodos()"
  (mainViewChange)="mainView = $event"
  (filterChange)="onFilterChange($event)"
  (navigateToCustomer)="navigateToCustomer($event)"
  (navigateToContract)="navigateToContract($event)"
  (navigateToMeter)="navigateToMeter($event)"
  (changeMonthEvent)="changeMonth($event)"
  (openDayEvent)="openDay($event)"
  (backToMonthEvent)="backToMonth()" />
}

<!-- Modal for Create/Edit TODO -->
<app-overlay-modal *ngIf="showModal" (close)="closeModal()">
  <div class="modal-header">
    <h2>{{ isEditMode ? 'TODO bearbeiten' : 'Neues TODO' }}</h2>
    <button class="btn-close" (click)="closeModal()">&times;</button>
  </div>

  <form (ngSubmit)="saveTodo()" #todoForm="ngForm">
    <div class="form-group">
      <label for="title">Titel *</label>
      <input type="text" id="title" name="title" [(ngModel)]="currentTodo.title" required
        class="form-control" placeholder="z.B. Adresse von Kunde ändern" />
    </div>

    <div class="form-group">
      <label for="description">Beschreibung</label>
      <textarea id="description" name="description" [(ngModel)]="currentTodo.description" rows="4"
        class="form-control" placeholder="Zusätzliche Details..."></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="priority">Priorität</label>
        <select id="priority" name="priority" [(ngModel)]="currentTodo.priority" class="form-control">
          <option value="low">Niedrig</option>
          <option value="medium">Mittel</option>
          <option value="high">Hoch</option>
        </select>
      </div>

      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" name="status" [(ngModel)]="currentTodo.status" class="form-control">
          <option value="open">Offen</option>
          <option value="in_progress">In Bearbeitung</option>
          <option value="completed">Erledigt</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label for="dueDate">Fälligkeitsdatum</label>
      <input type="date" id="dueDate" name="dueDate" [(ngModel)]="currentTodo.dueDate"
        class="form-control" />
    </div>

    <div class="form-section">
      <h3>Verknüpfungen (optional)</h3>

      <div class="form-group">
        <label for="relatedCustomerId">Kunde</label>
        <select id="relatedCustomerId" name="relatedCustomerId"
          [(ngModel)]="currentTodo.relatedCustomerId" class="form-control">
          <option [ngValue]="null">Kein Kunde</option>
          <option *ngFor="let customer of customers" [value]="customer._id">
            {{ customer.firstName }} {{ customer.lastName }} ({{ customer.customerNumber }})
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="relatedContractId">Vertrag</label>
        <select id="relatedContractId" name="relatedContractId"
          [(ngModel)]="currentTodo.relatedContractId" class="form-control">
          <option [ngValue]="null">Kein Vertrag</option>
          <option *ngFor="let contract of contracts" [value]="contract._id">
            {{ contract.contractNumber }} - {{ contract.customerId?.firstName }} {{
            contract.customerId?.lastName }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="relatedMeterId">Zähler</label>
        <select id="relatedMeterId" name="relatedMeterId" [(ngModel)]="currentTodo.relatedMeterId"
          class="form-control">
          <option [ngValue]="null">Kein Zähler</option>
          <option *ngFor="let meter of meters" [value]="meter._id">
            {{ meter.meterNumber }} ({{ getTypeLabel(meter.type) }})
          </option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-secondary" (click)="closeModal()">Abbrechen</button>
      <button type="submit" class="btn-primary" [disabled]="!todoForm.form.valid">
        {{ isEditMode ? 'Speichern' : 'Erstellen' }}
      </button>
    </div>
  </form>
</app-overlay-modal>
