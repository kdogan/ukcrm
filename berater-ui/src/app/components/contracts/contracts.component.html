@if(viewportService.isDesktop()){
<app-contracts-desktop
  [contracts]="contracts"

  (create)="showCreateModal()"
  (edit)="editContract($event)"
  (delete)="deleteContract($event)"

  (statusFilterChange)="onStatusChange($event)"
  (daysFilterChange)="onDaysChange($event)"

  (showCustomer)="showCustomerDetails($event)"
  (showMeter)="showMeterDetails($event)"
  (showSupplier)="showSupplierDetails($event)"

  (toggleActionMenu)="activeMenuId = $event"
/>
}

@if(viewportService.isMobile()){
<app-contracts-mobile
  [contracts]="contracts"
  (create)="showCreateModal()"
  (edit)="editContract($event)"
  (delete)="deleteContract($event)"

  (statusFilterChange)="onStatusChange($event)"
  (daysFilterChange)="onDaysChange($event)"

  (showCustomer)="showCustomerDetails($event)"
  (showMeter)="showMeterDetails($event)"
  (showSupplier)="showSupplierDetails($event)"
  (toggleActionMenu)="activeMenuId = $event"
  />
}



<!-- Modal for Create/Edit Contract -->
      <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditMode ? 'Vertrag bearbeiten' : 'Neuer Vertrag' }}</h2>
            <button class="btn-close" (click)="closeModal()">&times;</button>
          </div>
          <form (ngSubmit)="saveContract()" #contractForm="ngForm">
            <div class="form-group" *ngIf="isEditMode">
            <label>Vertragsnummer</label>
            <input
                type="text"
                class="form-control"
                [value]="currentContract.contractNumber"
                disabled
            />
            </div>

            <div class="form-group">
              <label for="customerId">Kunde *</label>
              <input
                type="text"
                placeholder="Suche nach Kunden..."
                [(ngModel)]="customerSearch"
                (ngModelChange)="filterCustomers()"
                (focus)="showCustomerDropdown = true"
                class="form-control search-input"
                [ngModelOptions]="{standalone: true}"
                autocomplete="off"
              />
              <div class="dropdown-list" *ngIf="showCustomerDropdown && filteredCustomers.length > 0">
                <div
                  *ngFor="let customer of filteredCustomers"
                  class="dropdown-item"
                  [class.selected]="currentContract.customerId === customer._id"
                  (click)="selectCustomer(customer)"
                >
                  {{ customer.firstName }} {{ customer.lastName }} ({{ customer.customerNumber }})
                </div>
              </div>
              <input type="hidden" id="customerId" name="customerId" [(ngModel)]="currentContract.customerId" required />
              <div class="selected-item" *ngIf="selectedCustomer">
                AusgewÃ¤hlt: <strong>{{ selectedCustomer.firstName }} {{ selectedCustomer.lastName }}</strong> ({{ selectedCustomer.customerNumber }})
                <button type="button" class="btn-clear" (click)="clearCustomer()">&times;</button>
              </div>
            </div>

            <div class="form-group">
              <label for="meterId">ZÃ¤hler *</label>
              <input
                type="text"
                placeholder="Suche nach ZÃ¤hlernummer..."
                [(ngModel)]="meterSearch"
                (ngModelChange)="filterMeters()"
                (focus)="showMeterDropdown = true"
                class="form-control search-input"
                [ngModelOptions]="{standalone: true}"
                autocomplete="off"
              />
              <div class="dropdown-list" *ngIf="showMeterDropdown && filteredFreeMeters.length > 0">
                <div
                  *ngFor="let meter of filteredFreeMeters"
                  class="dropdown-item"
                  [class.selected]="currentContract.meterId === meter._id"
                  [class.occupied]="!isMeterFree(meter)"
                  [class.disabled]="!isMeterFree(meter)"
                  (click)="isMeterFree(meter) && selectMeter(meter)"
                  [style.cursor]="isMeterFree(meter) ? 'pointer' : 'not-allowed'"
                >
                  {{ meter.meterNumber }} ({{ getTypeLabel(meter.type) }})
                  <span *ngIf="!isMeterFree(meter)" style="color: #c62828; font-weight: bold; margin-left: 0.5rem;">- Belegt</span>
                </div>
              </div>
              <input type="hidden" id="meterId" name="meterId" [(ngModel)]="currentContract.meterId" required />
              <div class="selected-item" *ngIf="selectedMeter">
                AusgewÃ¤hlt: <strong>{{ selectedMeter.meterNumber }}</strong> ({{ getTypeLabel(selectedMeter.type) }})
                <button type="button" class="btn-clear" (click)="clearMeter()">&times;</button>
              </div>
            </div>

            <div class="form-group">
              <label for="supplierId">Anbieter *</label>
              <select
                id="supplierId"
                name="supplierId"
                [(ngModel)]="currentContract.supplierId"
                required
                class="form-control"
              >
                <option value="">Bitte wÃ¤hlen</option>
                <option *ngFor="let supplier of suppliers" [value]="supplier._id">
                  {{ supplier.name }}
                </option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="startDate">Startdatum *</label>
                <input
                  type="date"
                  id="startDate"
                  name="startDate"
                  [(ngModel)]="currentContract.startDate"
                  required
                  class="form-control"
                />
              </div>

              <div class="form-group">
                <label for="durationMonths">Laufzeit (Monate) *</label>
                <input
                  type="number"
                  id="durationMonths"
                  name="durationMonths"
                  [(ngModel)]="currentContract.durationMonths"
                  required
                  min="1"
                  max="120"
                  placeholder="z.B. 24"
                  class="form-control"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <select
                id="status"
                name="status"
                [(ngModel)]="currentContract.status"
                class="form-control"
              >
                <option value="active">Aktiv</option>
                <option value="ended">Beendet</option>
                <option value="archived">Archiviert</option>
              </select>
            </div>

            <div class="form-group">
              <label for="notes">Notizen</label>
              <textarea
                id="notes"
                name="notes"
                [(ngModel)]="currentContract.notes"
                rows="3"
                placeholder="Optional: ZusÃ¤tzliche Informationen zum Vertrag"
                class="form-control"
              ></textarea>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn-secondary" (click)="closeModal()">Abbrechen</button>
              <button type="submit" class="btn-primary" [disabled]="!contractForm.form.valid || !isFormValid()">
                {{ isEditMode ? 'Speichern' : 'Erstellen' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Customer Details Modal -->
      <div class="modal-overlay" *ngIf="showCustomerDetailsModal" (click)="closeCustomerDetails()">
        <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Kundendetails</h2>
            <button class="btn-close" (click)="closeCustomerDetails()">&times;</button>
          </div>
          <div class="detail-content" *ngIf="selectedCustomerDetails">
            <div class="detail-row">
              <span class="detail-label">Kundennummer:</span>
              <span class="detail-value">{{ selectedCustomerDetails.customerNumber }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Name:</span>
              <span class="detail-value">{{ selectedCustomerDetails.firstName }} {{ selectedCustomerDetails.lastName }}</span>
            </div>
            <div class="detail-row" *ngIf="selectedCustomerDetails.email">
              <span class="detail-label">E-Mail:</span>
              <span class="detail-value">{{ selectedCustomerDetails.email }}</span>
            </div>
            <div class="detail-row" *ngIf="selectedCustomerDetails.phone">
              <span class="detail-label">Telefon:</span>
              <span class="detail-value">
                {{ selectedCustomerDetails.phone }}
                <a [href]="'tel:' + selectedCustomerDetails.phone" class="phone-link" title="Anrufen">ðŸ“ž</a>
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedCustomerDetails.address?.street || selectedCustomerDetails.address?.city">
              <span class="detail-label">Adresse:</span>
              <span class="detail-value">
                <span *ngIf="selectedCustomerDetails.address?.street">{{ selectedCustomerDetails.address?.street }}<br></span>
                <span *ngIf="selectedCustomerDetails.address?.zip || selectedCustomerDetails.address?.city">
                  {{ selectedCustomerDetails.address?.zip }} {{ selectedCustomerDetails.address?.city }}
                </span>
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedCustomerDetails.notes">
              <span class="detail-label">Notizen:</span>
              <span class="detail-value">{{ selectedCustomerDetails.notes }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Supplier Details Modal -->
      <div class="modal-overlay" *ngIf="showSupplierDetailsModal" (click)="closeSupplierDetails()">
        <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Anbieterdetails</h2>
            <button class="btn-close" (click)="closeSupplierDetails()">&times;</button>
          </div>
          <div class="detail-content" *ngIf="selectedSupplierDetails">
            <div class="detail-row">
              <span class="detail-label">Name:</span>
              <span class="detail-value">{{ selectedSupplierDetails.name }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Kurzbezeichnung:</span>
              <span class="detail-value">{{ selectedSupplierDetails.shortName }}</span>
            </div>
            <div class="detail-row" *ngIf="selectedSupplierDetails.address?.street || selectedSupplierDetails.address?.city">
              <span class="detail-label">Adresse:</span>
              <span class="detail-value">
                <span *ngIf="selectedSupplierDetails.address?.street">{{ selectedSupplierDetails.address?.street }}<br></span>
                <span *ngIf="selectedSupplierDetails.address?.zipCode || selectedSupplierDetails.address?.city">
                  {{ selectedSupplierDetails.address?.zipCode }} {{ selectedSupplierDetails.address?.city }}
                </span>
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedSupplierDetails.contactPhone">
              <span class="detail-label">Telefon:</span>
              <span class="detail-value">
                {{ selectedSupplierDetails.contactPhone }}
                <a [href]="'tel:' + selectedSupplierDetails.contactPhone" class="phone-link" title="Anrufen">ðŸ“ž</a>
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedSupplierDetails.contactEmail">
              <span class="detail-label">E-Mail:</span>
              <span class="detail-value">{{ selectedSupplierDetails.contactEmail }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Meter Details Modal -->
      <div class="modal-overlay" *ngIf="showMeterDetailsModal" (click)="closeMeterDetails()">
        <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>ZÃ¤hlerdetails</h2>
            <button class="btn-close" (click)="closeMeterDetails()">&times;</button>
          </div>
          <div class="detail-content" *ngIf="selectedMeterDetails">
            <div class="detail-row">
              <span class="detail-label">ZÃ¤hlernummer:</span>
              <span class="detail-value">{{ selectedMeterDetails.meterNumber }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Typ:</span>
              <span class="detail-value">{{ getTypeLabel(selectedMeterDetails.type) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value">
                <span class="badge" [class.badge-active]="!selectedMeterDetails.currentCustomerId">
                  {{ selectedMeterDetails.currentCustomerId ? 'Belegt' : 'Frei' }}
                </span>
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedMeterDetails.currentCustomerId">
              <span class="detail-label">Aktueller Kunde:</span>
              <span class="detail-value">
                {{ selectedMeterDetails.currentCustomerId.firstName }} {{ selectedMeterDetails.currentCustomerId.lastName }}
              </span>
            </div>
          </div>
        </div>
      </div>